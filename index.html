<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Paws & Preferences: Find Your Favourite Kitty</title>
    <meta name="description" content="Swipe right for like, left for dislike. Discover your favourite cats (powered by CATAAS)." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b0e14;
            --card: #111827;
            --muted: #94a3b8;
            --accent: #f59e0b;
            --like: #10b981;
            --nope: #ef4444;
        }

        * {
            box-sizing: border-box
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            background: radial-gradient(60% 60% at 50% 0%, #111827 0%, #0b0e14 60%);
            color: #e5e7eb;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app {
            width: 100%;
            max-width: 480px;
            height: 100vh;
            max-height: 900px;
            padding: 16px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .brand .logo {
                width: 36px;
                height: 36px;
                border-radius: 12px;
                background: linear-gradient(135deg,#f59e0b, #f43f5e);
                display: grid;
                place-items: center;
                font-weight: 700;
            }

            .brand .title {
                font-weight: 700;
                letter-spacing: .2px
            }

        .hint {
            font-size: 16px;
            color: var(--muted);
            line-height: 1.5;
        }

        .btn {
            height: 40px;
            padding: 0 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.12);
            background: #0f172a;
            color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(0,0,0,.35);
            transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
            user-select: none;
        }

            .btn:active {
                transform: scale(.97);
                box-shadow: 0 3px 10px rgba(0,0,0,.4);
            }

            .btn.primary {
                background: linear-gradient(135deg,#0ea5e9,#6366f1);
                border-color: transparent;
            }

        .stack {
            position: relative;
            flex: 1;
            overflow: visible;
            perspective: 1200px;
            user-select: none;
        }

        .card {
            position: absolute;
            inset: 0;
            border-radius: 22px;
            box-shadow: 0 12px 40px rgba(0,0,0,.45);
            background: var(--card) center/cover no-repeat;
            border: 1px solid rgba(255,255,255,.06);
            transform-origin: 50% 90%;
            touch-action: none;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 14px;
        }

        .badge {
            position: absolute;
            top: 16px;
            padding: 8px 12px;
            border-radius: 999px;
            font-weight: 700;
            letter-spacing: .5px;
            border: 2px solid currentColor;
            backdrop-filter: blur(6px);
        }

            .badge.like {
                left: 16px;
                color: var(--like);
            }

            .badge.nope {
                right: 16px;
                color: var(--nope);
            }

        .progress {
            height: 6px;
            width: 100%;
            background: rgba(255,255,255,.08);
            border-radius: 999px;
            overflow: hidden;
            margin-top: 10px;
        }

            .progress > span {
                display: block;
                height: 100%;
                width: 0%;
                background: linear-gradient(90deg,#f59e0b,#f43f5e);
                transition: width .25s ease
            }

        .summary {
            position: absolute;
            inset: 0;
            border-radius: 22px;
            background: rgba(15,23,42,.9);
            backdrop-filter: blur(8px);
            display: none;
            flex-direction: column;
            padding: 18px;
            overflow: auto
        }

            .summary.visible {
                display: flex
            }

            .summary h2 {
                margin: 6px 0 14px 0
            }

        .grid {
            display: grid;
            grid-template-columns: repeat(2,1fr);
            gap: 10px
        }

            .grid img {
                width: 100%;
                height: 180px;
                object-fit: cover;
                border-radius: 12px;
                border: 1px solid rgba(255,255,255,.08)
            }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,.06);
            color: #fff;
            font-size: 12px;
            border: 1px solid rgba(255,255,255,.08)
        }

        .empty {
            opacity: .85;
            color: var(--muted)
        }

        /* Onboarding overlay */
        .tutorial {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 20% 0%, rgba(15,23,42,.98), rgba(15,23,42,.92));
            z-index: 999;
            transition: opacity .3s ease;
        }

            .tutorial.hidden {
                opacity: 0;
                pointer-events: none;
            }

        .tutorial-box {
            max-width: 320px;
            padding: 20px 18px 18px;
            border-radius: 20px;
            background: rgba(15,23,42,1);
            border: 1px solid rgba(255,255,255,.1);
            box-shadow: 0 18px 40px rgba(0,0,0,.6);
            text-align: center;
        }

        .tutorial-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .tutorial-text {
            font-size: 15px;
            color: var(--muted);
            margin: 0 0 12px 0;
            line-height: 1.6;
        }

        .tutorial-ghost {
            position: relative;
            width: 220px;
            height: 260px;
            margin: 0 auto 10px;
            perspective: 1000px;
        }

        .tutorial-card {
            position: absolute;
            inset: 0;
            border-radius: 18px;
            background: linear-gradient(135deg,#1f2937,#0f172a);
            border: 1px solid rgba(255,255,255,.08);
            box-shadow: 0 10px 30px rgba(0,0,0,.6);
            animation: demo-swipe 1.9s ease-in-out infinite;
        }

        .tutorial-like, .tutorial-nope {
            position: absolute;
            top: 14px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 2px solid currentColor;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: .6px;
        }

        .tutorial-like {
            left: 12px;
            color: var(--like);
            opacity: 0.9;
        }

        .tutorial-nope {
            right: 12px;
            color: var(--nope);
            opacity: 0.9;
        }

        .tutorial-tap {
            font-size: 13px;
            color: #e5e7eb;
            opacity: .9;
            margin-top: 4px;
        }

        .tutorial-paw {
            font-size: 26px;
            margin-bottom: 6px;
        }

        /* Loading overlay */
        .loader-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(15,23,42,0.9);
            z-index: 900;
            opacity: 0;
            pointer-events: none;
            transition: opacity .25s ease;
        }

            .loader-overlay.visible {
                opacity: 1;
                pointer-events: auto;
            }

        .loader-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .loader-spinner {
            width: 42px;
            height: 42px;
            border-radius: 999px;
            border: 4px solid rgba(148,163,184,0.4);
            border-top-color: #f59e0b;
            animation: spin 0.8s linear infinite;
        }

        .loader-text {
            font-size: 14px;
            color: #e5e7eb;
            opacity: 0.9;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes demo-swipe {
            0% {
                transform: translateX(0) rotate(0deg);
            }

            15% {
                transform: translateX(36px) rotate(6deg);
            }
            /* like */
            30% {
                transform: translateX(0) rotate(0deg);
            }

            55% {
                transform: translateX(-36px) rotate(-6deg);
            }
            /* nope */
            70% {
                transform: translateX(0) rotate(0deg);
            }

            100% {
                transform: translateX(0) rotate(0deg);
            }
        }

        @media (min-height:900px) {
            .grid img {
                height: 220px
            }
        }
    </style>
</head>
<body>
    <main class="app">
        <header>
            <div class="brand">
                <div class="logo">üêæ</div>
                <div>
                    <div class="title">Paws & Preferences</div>
                    <div class="hint">Swipe <strong>right</strong> to Like ¬∑ <strong>left</strong> to Pass. Explore your favourite kitties by swiping on the photos!</div>
                </div>
            </div>
            <button id="resetBtn" class="btn" title="Restart" aria-label="Restart">Restart</button>
        </header>

        <!-- Progress bar just below description -->
        <div class="progress" aria-hidden="true">
            <span id="progressBar"></span>
        </div>

        <div class="stack" id="cardStack" aria-live="polite" aria-atomic="true"></div>

        <section id="summary" class="summary" role="region" aria-label="Summary">
            <h2>Summary</h2>
            <p id="summaryText" class="pill"></p>
            <div id="likedGrid" class="grid"></div>
            <p id="emptyMsg" class="empty" style="display:none">You didn't like any cats this round. Try another deck!</p>
            <div style="margin-top:auto; display:flex; gap:10px;">
                <button id="againBtn" class="btn primary" style="flex:1">Shuffle another deck</button>
            </div>
        </section>
    </main>

    <!-- Onboarding overlay -->
    <div id="tutorial" class="tutorial" role="dialog" aria-modal="true" aria-label="How to use Paws & Preferences">
        <div class="tutorial-box">
            <div class="tutorial-paw">üê±</div>
            <div class="tutorial-title">How it works</div>
            <p class="tutorial-text">Swipe <strong>right</strong> if you like the kitty. Swipe <strong>left</strong> if you want to pass. Go through all the cats to see your favourites.</p>
            <div class="tutorial-ghost" aria-hidden="true">
                <div class="tutorial-card">
                    <span class="tutorial-like">LIKE</span>
                    <span class="tutorial-nope">NOPE</span>
                </div>
            </div>
            <p class="tutorial-tap">Tap anywhere to start swiping</p>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loader" class="loader-overlay" aria-hidden="true">
        <div class="loader-box">
            <div class="loader-spinner"></div>
            <div class="loader-text">Finding cats‚Ä¶</div>
        </div>
    </div>

    <script>
        (function () {
            const TOTAL = 16; // 10‚Äì20 as per brief
            const WIDTH = 600, HEIGHT = 800;
            const SEEN_KEY = 'paws_seenTutorial_v1';
            const STATE_KEY = 'paws_state_v1';

            const stack = document.getElementById('cardStack');
            const progress = document.getElementById('progressBar');
            const summary = document.getElementById('summary');
            const likedGrid = document.getElementById('likedGrid');
            const summaryText = document.getElementById('summaryText');
            const emptyMsg = document.getElementById('emptyMsg');
            const resetBtn = document.getElementById('resetBtn');
            const againBtn = document.getElementById('againBtn');
            const tutorial = document.getElementById('tutorial');
            const loader = document.getElementById('loader');

            let deck = [];
            let liked = [];
            let index = 0;
            let tutorialVisible = !hasSeenTutorial();

            function hasSeenTutorial() {
                try { return !!localStorage.getItem(SEEN_KEY); } catch (e) { return false; }
            }

            function markTutorialSeen() {
                try { localStorage.setItem(SEEN_KEY, '1'); } catch (e) { }
            }

            function loadState() {
                try {
                    const raw = localStorage.getItem(STATE_KEY);
                    if (!raw) return null;
                    const parsed = JSON.parse(raw);
                    if (!parsed || !Array.isArray(parsed.deck)) return null;
                    return parsed;
                } catch (e) {
                    return null;
                }
            }

            function saveState() {
                try {
                    const state = { deck, liked, index };
                    localStorage.setItem(STATE_KEY, JSON.stringify(state));
                } catch (e) { }
            }

            function clearState() {
                try { localStorage.removeItem(STATE_KEY); } catch (e) { }
            }

            function hideTutorial() {
                if (!tutorialVisible) return;
                tutorialVisible = false;
                tutorial.classList.add('hidden');
                markTutorialSeen();
            }

            function showLoader() {
                loader.classList.add('visible');
            }
            function hideLoader() {
                loader.classList.remove('visible');
            }

            if (!tutorialVisible) {
                tutorial.classList.add('hidden');
            }

            tutorial.addEventListener('click', hideTutorial);

            const rnd = () => Math.random().toString(36).slice(2);

            function buildNewDeck(count) {
                const urls = [];
                for (let i = 0; i < count; i++) {
                    const u = `https://cataas.com/cat?width=${WIDTH}&height=${HEIGHT}&type=square&seed=${rnd()}_${i}`;
                    urls.push(u);
                }
                return urls;
            }

            function preload(urls) {
                if (!urls.length) return Promise.resolve([]);
                return Promise.all(urls.map(u => new Promise(res => {
                    const img = new Image();
                    img.onload = () => res(u);
                    img.onerror = () => res(u);
                    img.src = u;
                })));
            }

            function createCard(url, z) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.backgroundImage = `url('${url}')`;
                card.style.zIndex = String(100 + z);

                const likeBadge = document.createElement('div');
                likeBadge.className = 'badge like'; likeBadge.textContent = 'LIKE'; likeBadge.style.opacity = 0; card.appendChild(likeBadge);
                const nopeBadge = document.createElement('div');
                nopeBadge.className = 'badge nope'; nopeBadge.textContent = 'NOPE'; nopeBadge.style.opacity = 0; card.appendChild(nopeBadge);

                attachDrag(card, url, likeBadge, nopeBadge);
                return card;
            }

            function layoutStack() {
                const cards = Array.from(stack.children);
                cards.forEach((c, i) => {
                    const offset = cards.length - 1 - i;
                    c.style.transform = `translateY(${offset * 6}px) scale(${1 - offset * 0.02})`;
                    c.style.opacity = String(1 - offset * 0.06);
                });
            }

            function attachDrag(card, url, likeBadge, nopeBadge) {
                let startX = 0, startY = 0, currentX = 0, currentY = 0, dragging = false;
                let pointerId = null;

                const onDown = (e) => {
                    hideTutorial();
                    const p = getPoint(e);
                    pointerId = p.pointerId;
                    startX = p.x; startY = p.y; dragging = true; card.setPointerCapture?.(pointerId);
                };
                const onMove = (e) => {
                    if (!dragging) return; const p = getPoint(e);
                    currentX = p.x - startX; currentY = p.y - startY;
                    const rot = currentX * 0.05;
                    card.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rot}deg)`;
                    const likeOpacity = clamp(map(currentX, 0, 140, 0, 1));
                    const nopeOpacity = clamp(map(currentX, 0, -140, 0, 1));
                    likeBadge.style.opacity = likeOpacity;
                    nopeBadge.style.opacity = nopeOpacity;
                };
                const onUp = () => {
                    if (!dragging) return; dragging = false; card.releasePointerCapture?.(pointerId);
                    const threshold = 100;
                    if (currentX > threshold) { swipeOut('right'); }
                    else if (currentX < -threshold) { swipeOut('left'); }
                    else {
                        card.style.transition = 'transform .25s ease';
                        card.style.transform = ''; likeBadge.style.opacity = 0; nopeBadge.style.opacity = 0;
                        card.addEventListener('transitionend', () => { card.style.transition = ''; layoutStack(); }, { once: true });
                    }
                };

                function swipeOut(dir) {
                    card.style.transition = 'transform .28s ease, opacity .28s ease';
                    const toX = (dir === 'right') ? window.innerWidth * 1.2 : -window.innerWidth * 1.2;
                    const toY = currentY + (Math.random() * 80 - 40);
                    card.style.transform = `translate(${toX}px, ${toY}px) rotate(${dir === 'right' ? 25 : -25}deg)`;
                    card.style.opacity = 0;
                    likeBadge.style.opacity = dir === 'right' ? 1 : 0; nopeBadge.style.opacity = dir === 'left' ? 1 : 0;
                    card.addEventListener('transitionend', () => {
                        card.remove();
                        if (dir === 'right') liked.push(url);
                        index++;
                        saveState();
                        updateProgress();
                        nextIfDone();
                        layoutStack();
                    }, { once: true });
                }

                card.addEventListener('pointerdown', onDown);
                card.addEventListener('pointermove', onMove);
                card.addEventListener('pointerup', onUp);
                card.addEventListener('pointercancel', onUp);
            }

            function updateProgress() {
                const pct = deck.length ? Math.min(100, Math.round((index / deck.length) * 100)) : 0;
                progress.style.width = pct + '%';
            }

            function nextIfDone() {
                if (index >= deck.length && deck.length > 0) {
                    showSummary();
                }
            }

            function showSummary() {
                summary.classList.add('visible');
                likedGrid.innerHTML = '';
                if (liked.length) {
                    emptyMsg.style.display = 'none';
                    liked.forEach(u => {
                        const img = document.createElement('img'); img.src = u; img.alt = 'Liked cat'; likedGrid.appendChild(img);
                    });
                } else {
                    emptyMsg.style.display = 'block';
                }
                summaryText.textContent = `You liked ${liked.length} / ${deck.length} cats`;
            }

            function hideSummary() { summary.classList.remove('visible'); }

            async function bootstrap(fromSaved = true) {
                hideSummary();
                stack.innerHTML = '';
                showLoader();

                if (fromSaved) {
                    const state = loadState();
                    if (state && Array.isArray(state.deck) && state.deck.length) {
                        deck = state.deck;
                        liked = Array.isArray(state.liked) ? state.liked : [];
                        index = typeof state.index === 'number' ? state.index : 0;
                    } else {
                        deck = buildNewDeck(TOTAL);
                        liked = [];
                        index = 0;
                        saveState();
                    }
                } else {
                    deck = buildNewDeck(TOTAL);
                    liked = [];
                    index = 0;
                    clearState();
                    saveState();
                }

                const remaining = deck.slice(index);
                await preload(remaining);
                [...remaining].reverse().forEach((url, i) => stack.appendChild(createCard(url, i)));
                layoutStack();
                stack.setAttribute('aria-label', `Loaded ${remaining.length || 0} remaining cats. Swipe to choose.`);
                updateProgress();

                hideLoader();

                if (!tutorialVisible) {
                    tutorial.classList.add('hidden');
                } else {
                    tutorial.classList.remove('hidden');
                }

                if (index >= deck.length && deck.length > 0) {
                    showSummary();
                }
            }

            resetBtn.addEventListener('click', () => bootstrap(false));
            againBtn.addEventListener('click', () => bootstrap(false));

            function getPoint(e) {
                const t = e.touches?.[0];
                return {
                    x: t ? t.clientX : (e.clientX ?? 0),
                    y: t ? t.clientY : (e.clientY ?? 0),
                    pointerId: e.pointerId ?? 1
                };
            }
            const clamp = (n, min = 0, max = 1) => Math.max(min, Math.min(max, n));
            const map = (x, inMin, inMax, outMin, outMax) => {
                const t = (x - inMin) / (inMax - inMin); return outMin + t * (outMax - outMin);
            };

            bootstrap(true);
        })();
    </script>
</body>
</html>
